<div align="center">

# âœ¨ SyncCaster

_**ä¸€æ¬¡ç¼–è¾‘ï¼Œå¤„å¤„å‘å¸ƒ**_

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Chrome Extension](https://img.shields.io/badge/Chrome-Extension%20MV3-4285F4?logo=googlechrome&logoColor=white)](#)
[![Vue 3](https://img.shields.io/badge/Vue-3.x-4FC08D?logo=vuedotjs&logoColor=white)](#)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-3178C6?logo=typescript&logoColor=white)](#)

</div>

SyncCaster æ˜¯ä¸€ä¸ªæµè§ˆå™¨æ‰©å±•ï¼Œå¸®åŠ©å†…å®¹åˆ›ä½œè€…å°†æ–‡ç« ä¸€é”®åŒæ­¥åˆ°å¤šä¸ªåšå®¢å¹³å°ã€‚

> ğŸ”’ æœ¬æ‰©å±•å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œä¸æ”¶é›†ã€ä¸å­˜å‚¨ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚**å¦‚éœ€æ·»åŠ æ›´å¤šå¹³å°æˆ–æ”¹å–„åŒæ­¥å‡†ç¡®åº¦ï¼Œæ¬¢è¿æ Issue æˆ– PR**ã€‚

## ç‰¹æ€§

- ğŸ“ å†…ç½® Markdown ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆ
- ğŸ” æ™ºèƒ½é‡‡é›†ä»»æ„ç½‘é¡µæ–‡ç« å†…å®¹
- ğŸš€ ä¸€é”®åŒæ­¥åˆ° 17+ ä¸»æµåšå®¢å¹³å°
- ğŸ” è‡ªåŠ¨æ£€æµ‹å„å¹³å°ç™»å½•çŠ¶æ€
- ğŸ“ åŒæ­¥çš„æ ‡ç­¾é¡µè‡ªåŠ¨å½’å…¥åˆ†ç»„ï¼Œä¾¿äºç®¡ç†
- ğŸ¨ å¾®ä¿¡å…¬ä¼—å·åŒæ­¥æ—¶å®Œæ•´ä¿ç•™æ¸²æŸ“æ ·å¼
- ğŸ§® æ”¯æŒ LaTeX æ•°å­¦å…¬å¼æ¸²æŸ“

## å·²æ”¯æŒçš„å¹³å°

| å¹³å° | Markdown | LaTeX | å¤‡æ³¨ |
|:----:|:--------:|:-----:|:-----|
| æ˜é‡‘ | âœ… | âœ… | |
| CSDN | âœ… | âœ… | |
| åšå®¢å›­ | âœ… | âœ… | éœ€å¼€å¯æ•°å­¦å…¬å¼æ”¯æŒ |
| 51CTO | âœ… | âœ… | |
| è…¾è®¯äº‘ | âœ… | âœ… | |
| çŸ¥ä¹ | âŒ | âš ï¸ | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ |
| ç®€ä¹¦ | âœ… | âŒ | |
| é˜¿é‡Œäº‘ | âœ… | âš ï¸ | |
| æ€å¦ | âœ… | âš ï¸ | |
| å“”å“©å“”å“© | âœ… | âŒ | |
| å¾®ä¿¡å…¬ä¼—å· | âŒ | âœ… | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒä¸»é¢˜æ ·å¼ |
| å¼€æºä¸­å›½ | âœ… | âš ï¸ | |
| ä»Šæ—¥å¤´æ¡ | âŒ | âŒ | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ |
| InfoQ | âœ… | âš ï¸ | |
| ç™¾å®¶å· | âŒ | âŒ | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ |
| ç½‘æ˜“å· | âŒ | âŒ | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ |
| Medium | âœ… | âŒ | è‹±æ–‡å¹³å° |

## å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘æ¨¡å¼
pnpm dev

# æ„å»º
pnpm build

# è¿è¡Œæµ‹è¯•
pnpm test
```

### åŠ è½½æ‰©å±•

1. æ‰“å¼€ Chromeï¼Œè®¿é—® `chrome://extensions/`
2. å¼€å¯å³ä¸Šè§’çš„ **å¼€å‘è€…æ¨¡å¼**
3. ç‚¹å‡» **åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº**
4. é€‰æ‹© `apps/extension/dist` ç›®å½•

## é¡¹ç›®ç»“æ„

```
SyncCaster/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ extension/              # Chrome æ‰©å±•åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ background/     # Service Workerï¼ˆåå°è„šæœ¬ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ index.ts              # æ¶ˆæ¯å¤„ç†ã€ä»»åŠ¡è°ƒåº¦
â”‚       â”‚   â”‚   â”œâ”€â”€ account-service.ts    # è´¦å·ç®¡ç†æœåŠ¡
â”‚       â”‚   â”‚   â”œâ”€â”€ platform-api.ts       # å¹³å° API è°ƒç”¨
â”‚       â”‚   â”‚   â”œâ”€â”€ publish-engine.ts     # å‘å¸ƒå¼•æ“æ ¸å¿ƒ
â”‚       â”‚   â”‚   â”œâ”€â”€ publish-progress.ts   # å‘å¸ƒè¿›åº¦ç®¡ç†
â”‚       â”‚   â”‚   â”œâ”€â”€ tab-group-manager.ts  # æ ‡ç­¾é¡µåˆ†ç»„ç®¡ç†
â”‚       â”‚   â”‚   â”œâ”€â”€ wechat-md-publish.ts  # å¾®ä¿¡å…¬ä¼—å·å‘å¸ƒ
â”‚       â”‚   â”‚   â””â”€â”€ inpage-runner.ts      # ç«™å†…è„šæœ¬æ‰§è¡Œå™¨
â”‚       â”‚   â”œâ”€â”€ content-scripts/          # å†…å®¹è„šæœ¬ï¼ˆé¡µé¢æ³¨å…¥ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ index.ts              # å…¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ auth-detector.ts      # ç™»å½•çŠ¶æ€æ£€æµ‹
â”‚       â”‚   â”‚   â”œâ”€â”€ canonical-collector.ts # å†…å®¹é‡‡é›†å™¨
â”‚       â”‚   â”‚   â””â”€â”€ collector-utils.ts    # é‡‡é›†å·¥å…·å‡½æ•°
â”‚       â”‚   â””â”€â”€ ui/                       # ç”¨æˆ·ç•Œé¢
â”‚       â”‚       â”œâ”€â”€ popup/                # å¼¹å‡ºçª—å£
â”‚       â”‚       â”œâ”€â”€ sidepanel/            # ä¾§è¾¹æ 
â”‚       â”‚       â””â”€â”€ options/              # è®¾ç½®é¡µé¢ï¼ˆä¸»ç•Œé¢ï¼‰
â”‚       â”‚           â”œâ”€â”€ views/            # é¡µé¢è§†å›¾
â”‚       â”‚           â”‚   â”œâ”€â”€ Dashboard.vue # ä»ªè¡¨ç›˜
â”‚       â”‚           â”‚   â”œâ”€â”€ Editor.vue    # Markdown ç¼–è¾‘å™¨
â”‚       â”‚           â”‚   â”œâ”€â”€ Posts.vue     # æ–‡ç« ç®¡ç†
â”‚       â”‚           â”‚   â”œâ”€â”€ Accounts.vue  # è´¦å·ç®¡ç†
â”‚       â”‚           â”‚   â””â”€â”€ Tasks.vue     # ä»»åŠ¡ç®¡ç†
â”‚       â”‚           â””â”€â”€ components/       # ç»„ä»¶
â”‚       â”œâ”€â”€ public/
â”‚       â”‚   â””â”€â”€ md-editor/      # å†…åµŒ Markdown ç¼–è¾‘å™¨
â”‚       â””â”€â”€ dist/               # æ„å»ºè¾“å‡º
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ adapters/               # å¹³å°é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ base-adapter.ts # é€‚é…å™¨åŸºç±»
â”‚   â”‚       â”œâ”€â”€ juejin.ts       # æ˜é‡‘
â”‚   â”‚       â”œâ”€â”€ csdn.ts         # CSDN
â”‚   â”‚       â”œâ”€â”€ zhihu.ts        # çŸ¥ä¹
â”‚   â”‚       â”œâ”€â”€ jianshu.ts      # ç®€ä¹¦
â”‚   â”‚       â”œâ”€â”€ cnblogs.ts      # åšå®¢å›­
â”‚   â”‚       â”œâ”€â”€ wechat.ts       # å¾®ä¿¡å…¬ä¼—å·
â”‚   â”‚       â”œâ”€â”€ 51cto.ts        # 51CTO
â”‚   â”‚       â”œâ”€â”€ tencent-cloud.ts # è…¾è®¯äº‘
â”‚   â”‚       â”œâ”€â”€ aliyun.ts       # é˜¿é‡Œäº‘
â”‚   â”‚       â”œâ”€â”€ segmentfault.ts # æ€å¦
â”‚   â”‚       â”œâ”€â”€ bilibili.ts     # å“”å“©å“”å“©
â”‚   â”‚       â”œâ”€â”€ oschina.ts      # å¼€æºä¸­å›½
â”‚   â”‚       â”œâ”€â”€ toutiao.ts      # ä»Šæ—¥å¤´æ¡
â”‚   â”‚       â”œâ”€â”€ infoq.ts        # InfoQ
â”‚   â”‚       â”œâ”€â”€ baijiahao.ts    # ç™¾å®¶å·
â”‚   â”‚       â”œâ”€â”€ wangyihao.ts    # ç½‘æ˜“å·
â”‚   â”‚       â”œâ”€â”€ medium.ts       # Medium
â”‚   â”‚       â””â”€â”€ index.ts        # é€‚é…å™¨æ³¨å†Œ
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ types/          # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ db/             # IndexedDB æ•°æ®åº“ï¼ˆDexieï¼‰
â”‚   â”‚       â”œâ”€â”€ ast/            # AST å¤„ç†ï¼ˆDOM â†’ è§„èŒƒåŒ–ï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ canonical-ast.ts   # è§„èŒƒåŒ– AST å®šä¹‰
â”‚   â”‚       â”‚   â”œâ”€â”€ dom-to-ast.ts      # DOM è½¬ AST
â”‚   â”‚       â”‚   â”œâ”€â”€ ast-transformer.ts # AST è½¬æ¢å™¨
â”‚   â”‚       â”‚   â”œâ”€â”€ ast-serializer.ts  # AST åºåˆ—åŒ–
â”‚   â”‚       â”‚   â””â”€â”€ pipeline.ts        # å¤„ç†ç®¡é“
â”‚   â”‚       â”œâ”€â”€ collector/      # å†…å®¹é‡‡é›†
â”‚   â”‚       â”‚   â”œâ”€â”€ canonical-collector.ts # è§„èŒƒåŒ–é‡‡é›†å™¨
â”‚   â”‚       â”‚   â””â”€â”€ platform-rules.ts      # å¹³å°è§„åˆ™
â”‚   â”‚       â”œâ”€â”€ renderer/       # Markdown æ¸²æŸ“
â”‚   â”‚       â”‚   â””â”€â”€ mdh-core.ts # MDH æ¸²æŸ“æ ¸å¿ƒ
â”‚   â”‚       â”œâ”€â”€ wechat/         # å¾®ä¿¡å…¬ä¼—å·ä¸“ç”¨
â”‚   â”‚       â”‚   â”œâ”€â”€ wechat-formatter.ts # æ ¼å¼åŒ–å™¨
â”‚   â”‚       â”‚   â”œâ”€â”€ renderer.ts         # æ¸²æŸ“å™¨
â”‚   â”‚       â”‚   â””â”€â”€ themes.ts           # ä¸»é¢˜æ ·å¼
â”‚   â”‚       â”œâ”€â”€ assets/         # èµ„æºå¤„ç†
â”‚   â”‚       â”‚   â”œâ”€â”€ image-pipeline.ts   # å›¾ç‰‡å¤„ç†ç®¡é“
â”‚   â”‚       â”‚   â””â”€â”€ platform-strategies.ts # å¹³å°ç­–ç•¥
â”‚   â”‚       â””â”€â”€ storage/        # å­˜å‚¨æ¡¥æ¥
â”‚   â”‚           â””â”€â”€ chrome-storage-bridge.ts
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”œâ”€â”€ md/                         # Markdown ç¼–è¾‘å™¨å­é¡¹ç›®
â”‚   â””â”€â”€ apps/web/               # Web ç¼–è¾‘å™¨åº”ç”¨
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ WECHAT_PUBLISH_FLOW.md  # å¾®ä¿¡å‘å¸ƒæµç¨‹
â”‚   â”œâ”€â”€ WECHAT_FORMATTER.md     # å¾®ä¿¡æ ¼å¼åŒ–å™¨
â”‚   â”œâ”€â”€ CROSS_PLATFORM_PUBLISH.md # è·¨å¹³å°å‘å¸ƒ
â”‚   â”œâ”€â”€ CANONICAL_AST_UPGRADE.md  # AST å‡çº§è¯´æ˜
â”‚   â”œâ”€â”€ LOGIN_STATE_MANAGEMENT.md # ç™»å½•çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ ...
â””â”€â”€ scripts/                    # æ„å»ºè„šæœ¬
```

## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Vue 3 + TypeScript
- **æ„å»ºå·¥å…·**: Vite + pnpm (monorepo)
- **UI æ¡†æ¶**: Naive UI + UnoCSS
- **æ•°æ®å­˜å‚¨**: IndexedDB (Dexie.js)
- **Markdown**: marked + highlight.js + KaTeX + Mermaid
- **æ‰©å±• API**: Chrome Extension Manifest V3

## æ ¸å¿ƒåŠŸèƒ½

### 1. å†…å®¹é‡‡é›†
- ä»ä»»æ„ç½‘é¡µé‡‡é›†æ–‡ç« å†…å®¹
- æ™ºèƒ½æå–æ ‡é¢˜ã€æ­£æ–‡ã€å›¾ç‰‡ã€å…¬å¼
- åŸºäº AST çš„è§„èŒƒåŒ–å¤„ç†ï¼ˆCanonicalASTï¼‰
- è½¬æ¢ä¸ºç»Ÿä¸€çš„ Markdown æ ¼å¼

### 2. Markdown ç¼–è¾‘å™¨
- å†…ç½®åŠŸèƒ½å®Œæ•´çš„ Markdown ç¼–è¾‘å™¨
- å®æ—¶é¢„è§ˆï¼Œæ”¯æŒä»£ç é«˜äº®
- LaTeX æ•°å­¦å…¬å¼æ¸²æŸ“ï¼ˆKaTeXï¼‰
- Mermaid å›¾è¡¨æ”¯æŒ
- å¤šç§ä¸»é¢˜æ ·å¼

### 3. å¤šå¹³å°å‘å¸ƒ
- æ”¯æŒ 17+ ä¸»æµåšå®¢å¹³å°
- DOM è‡ªåŠ¨åŒ–æ¨¡æ‹Ÿäººå·¥å‘å¸ƒ
- ç»Ÿä¸€çš„é€‚é…å™¨æ¥å£
- æ™ºèƒ½å›¾ç‰‡å¤„ç†å’Œä¸Šä¼ 

### 4. è´¦å·ç®¡ç†
- è‡ªåŠ¨æ£€æµ‹å¹³å°ç™»å½•çŠ¶æ€
- Cookie è¿‡æœŸé¢„è­¦
- ä¸€é”®åˆ·æ–°è´¦å·çŠ¶æ€
- æ”¯æŒé‡æ–°ç™»å½•

### 5. ä»»åŠ¡ç®¡ç†
- å‘å¸ƒä»»åŠ¡é˜Ÿåˆ—
- å®æ—¶è¿›åº¦è·Ÿè¸ª
- è¯¦ç»†æ—¥å¿—è®°å½•
- å¤±è´¥é‡è¯•æœºåˆ¶

## é€‚é…å™¨æ¶æ„

### é€‚é…å™¨æ¥å£

```typescript
interface PlatformAdapter {
  id: PlatformId;           // å¹³å°æ ‡è¯†
  name: string;             // å¹³å°åç§°
  kind: 'dom' | 'api';      // é€‚é…å™¨ç±»å‹
  capabilities: {           // å¹³å°èƒ½åŠ›
    supportsMarkdown: boolean;
    supportsHtml: boolean;
    supportsTags: boolean;
    supportsLatex: boolean;
    // ...
  };
  
  ensureAuth(ctx): Promise<AuthSession>;     // è®¤è¯æ£€æŸ¥
  transform(post, ctx): Promise<Payload>;    // å†…å®¹è½¬æ¢
  publish(payload, ctx): Promise<Result>;    // å‘å¸ƒ
  
  dom?: {                   // DOM è‡ªåŠ¨åŒ–é…ç½®
    matchers: string[];     // åŒ¹é…çš„ URL æ¨¡å¼
    fillAndPublish(payload): Promise<Result>;
  };
}
```

### å‘å¸ƒæµç¨‹

```
1. ç”¨æˆ·é€‰æ‹©æ–‡ç« å’Œç›®æ ‡å¹³å°
2. åˆ›å»ºå‘å¸ƒä»»åŠ¡ï¼ˆJobï¼‰
3. å¯¹æ¯ä¸ªç›®æ ‡å¹³å°ï¼š
   a. è·å–é€‚é…å™¨
   b. æ£€æŸ¥è®¤è¯çŠ¶æ€
   c. è½¬æ¢å†…å®¹æ ¼å¼ï¼ˆMarkdown/HTMLï¼‰
   d. å¤„ç†å›¾ç‰‡èµ„æº
   e. æ‰§è¡Œå‘å¸ƒï¼š
      - DOM æ¨¡å¼ï¼šæ‰“å¼€ç›®æ ‡é¡µé¢ï¼Œæ‰§è¡Œ fillAndPublish
      - API æ¨¡å¼ï¼šç›´æ¥è°ƒç”¨å¹³å° API
   f. è®°å½•ç»“æœ
4. æ›´æ–°ä»»åŠ¡çŠ¶æ€
5. æ ‡ç­¾é¡µè‡ªåŠ¨å½’å…¥åˆ†ç»„
```

## æ•°æ®æ¨¡å‹

### CanonicalPostï¼ˆç»Ÿä¸€å†…å®¹æ¨¡å‹ï¼‰

```typescript
interface CanonicalPost {
  id: string;
  title: string;
  body_md: string;      // Markdown æ­£æ–‡
  summary?: string;
  cover?: AssetRef;
  tags?: string[];
  categories?: string[];
  assets?: AssetRef[];  // å›¾ç‰‡ç­‰èµ„æº
  formulas?: MathNode[]; // æå–çš„å…¬å¼
}
```

### Accountï¼ˆè´¦å·æ¨¡å‹ï¼‰

```typescript
interface Account {
  id: string;
  platform: PlatformId;
  nickname: string;
  avatar?: string;
  status: 'active' | 'expired';
  cookieExpiresAt?: number;
  lastError?: string;
}
```

### Jobï¼ˆå‘å¸ƒä»»åŠ¡ï¼‰

```typescript
interface Job {
  id: string;
  postId: string;
  targets: PublishTarget[];
  state: 'PENDING' | 'RUNNING' | 'PAUSED' | 'FAILED' | 'DONE';
  progress: number;
  logs: LogEntry[];
}
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é€‚é…å™¨

1. åœ¨ `packages/adapters/src/` åˆ›å»ºæ–°æ–‡ä»¶
2. ç»§æ‰¿ `BaseAdapter` æˆ–å®ç° `PlatformAdapter` æ¥å£
3. åœ¨ `index.ts` ä¸­å¯¼å‡ºå¹¶æ³¨å†Œ
4. åœ¨ `packages/core/src/types/platforms.ts` æ·»åŠ å¹³å° ID

```typescript
// newplatform.ts
import { BaseAdapter } from './base-adapter';

export class NewPlatformAdapter extends BaseAdapter {
  id = 'newplatform' as const;
  name = 'æ–°å¹³å°';
  
  dom = {
    matchers: ['https://newplatform.com/editor*'],
    async fillAndPublish(payload) {
      // å®ç° DOM è‡ªåŠ¨åŒ–é€»è¾‘
    },
  };
}
```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹åå°æ—¥å¿—**: å³é”®æ‰©å±•å›¾æ ‡ â†’ æ£€æŸ¥ Service Worker
2. **æŸ¥çœ‹é¡µé¢æ—¥å¿—**: åœ¨ç›®æ ‡å¹³å°é¡µé¢æ‰“å¼€å¼€å‘è€…å·¥å…·
3. **è°ƒè¯•æ¨¡å¼**: ä¿®æ”¹ `publish-engine.ts` ä¸­çš„ `closeTab: false` ä¿æŒæ ‡ç­¾é¡µæ‰“å¼€

## ç›¸å…³æ–‡æ¡£

- [å¾®ä¿¡å…¬ä¼—å·å‘å¸ƒæµç¨‹](./WECHAT_PUBLISH_FLOW.md)
- [å¾®ä¿¡æ ¼å¼åŒ–å™¨](./WECHAT_FORMATTER.md)
- [è·¨å¹³å°å‘å¸ƒ](./CROSS_PLATFORM_PUBLISH.md)
- [è§„èŒƒåŒ– AST å‡çº§](./CANONICAL_AST_UPGRADE.md)
- [ç™»å½•çŠ¶æ€ç®¡ç†](./LOGIN_STATE_MANAGEMENT.md)
- [è´¦å·åˆ·æ–°ä¼˜åŒ–](./ACCOUNT_REFRESH_IMPROVEMENT.md)
- [æµ‹è¯•æ¸…å•](./TEST_CHECKLIST.md)

## License

MIT
